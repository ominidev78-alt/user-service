import { pool } from '../config/db.js';import { Provider } from '../types/user.js';export class ProviderModel {  static async create({ code, name, base_url, active }: {    code: string;    name: string;    base_url?: string;    active?: boolean;  }): Promise<Provider | null> {    const { rows } = await pool.query(      `      INSERT INTO providers        (code, name, base_url, active)      VALUES        ($1, $2, $3, $4)      RETURNING *;      `,      [code, name, base_url || null, active !== undefined ? active : true]    );    return rows[0] || null;  }  static async findAll({ active, search, limit, offset }: {    active?: boolean;    search?: string;    limit?: number | string;    offset?: number | string;  } = {}): Promise<Provider[]> {    const params: any[] = [];    let where = '1=1';    if (active !== undefined) {      params.push(active);      where += ` AND active = $${params.length}`;    }    if (search) {      params.push(`%${search}%`);      params.push(`%${search}%`);      where += ` AND (name ILIKE $${params.length - 1} OR code ILIKE $${params.length})`;    }    const limitValue = limit && Number.isFinite(Number(limit)) ? Number(limit) : 100;    const offsetValue = offset && Number.isFinite(Number(offset)) ? Number(offset) : 0;    params.push(limitValue);    params.push(offsetValue);    const { rows } = await pool.query(      `      SELECT *      FROM providers      WHERE ${where}      ORDER BY created_at DESC      LIMIT $${params.length - 1}      OFFSET $${params.length};      `,      params    );    return rows;  }  static async findById(id: number | string): Promise<Provider | null> {    const { rows } = await pool.query(      `      SELECT *      FROM providers      WHERE id = $1      LIMIT 1;      `,      [id]    );    return rows[0] || null;  }  static async findByCode(code: string): Promise<Provider | null> {    const { rows } = await pool.query(      `      SELECT *      FROM providers      WHERE code = $1      LIMIT 1;      `,      [code]    );    return rows[0] || null;  }  static async update(id: number | string, data: Partial<Provider>): Promise<Provider | null> {    const updates = [];    const params = [];    let paramIndex = 1;    if (data.code !== undefined) {      params.push(data.code);      updates.push(`code = $${paramIndex}`);      paramIndex++;    }    if (data.name !== undefined) {      params.push(data.name);      updates.push(`name = $${paramIndex}`);      paramIndex++;    }    if (data.base_url !== undefined) {      params.push(data.base_url);      updates.push(`base_url = $${paramIndex}`);      paramIndex++;    }    if (data.active !== undefined) {      params.push(data.active);      updates.push(`active = $${paramIndex}`);      paramIndex++;    }    if (updates.length === 0) {      return await this.findById(id);    }    params.push(id);    const idParamIndex = paramIndex;    const { rows } = await pool.query(      `      UPDATE providers      SET ${updates.join(', ')}      WHERE id = $${idParamIndex}      RETURNING *;      `,      params    );    return rows[0] || null;  }  static async updateStatus(id: number | string, active: boolean): Promise<Provider | null> {    const { rows } = await pool.query(      `      UPDATE providers      SET        active = $2      WHERE id = $1      RETURNING *;      `,      [id, active]    );    return rows[0] || null;  }  static async delete(id: number | string): Promise<Provider | null> {    const { rows } = await pool.query(      `      DELETE FROM providers      WHERE id = $1      RETURNING *;      `,      [id]    );    return rows[0] || null;  }  static async count({ active, search }: { active?: boolean; search?: string } = {}): Promise<number> {    const params: any[] = [];    let where = '1=1';    if (active !== undefined) {      params.push(active);      where += ` AND active = $${params.length}`;    }    if (search) {      params.push(`%${search}%`);      params.push(`%${search}%`);      where += ` AND (name ILIKE $${params.length - 1} OR code ILIKE $${params.length})`;    }    const { rows } = await pool.query(      `      SELECT COUNT(*) as total      FROM providers      WHERE ${where};      `,      params    );    return Number(rows[0]?.total || 0);  }}